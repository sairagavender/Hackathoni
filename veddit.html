<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Veddit — Campus Forum</title>
  <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore-compat.js"></script>
  
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root{--bg:#f5f7fb;--card:#fff;--muted:#6b7280;--accent:#4f46e5;--accent-hover:#4338ca;--danger:#ef4444;--success:#16a34a; --line-color: #e5e7eb;}
    body{font-family:'Inter', system-ui, -apple-system, sans-serif; margin:0; padding:20px; background:var(--bg); color:#1f2937;}
    .wrap{max-width:900px; margin:0 auto}
    
    /* Header */
    header{display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;}
    h1{margin:0; font-size:22px; color:#111827;}
    .small{font-size:13px; color:var(--muted)}
    
    /* Cards */
    .card{background:var(--card); padding:16px; border-radius:12px; box-shadow:0 4px 6px -1px rgba(0,0,0,0.05); margin-bottom:16px; border:1px solid #e5e7eb;}
    .hidden{display:none !important;}

    /* Inputs */
    input,textarea,select{padding:10px 12px; border-radius:8px; border:1px solid #d1d5db; width:100%; box-sizing:border-box; font-family:inherit; margin-bottom:8px;}
    input:focus, textarea:focus{outline:none; border-color:var(--accent); ring:2px var(--accent);}
    
    /* Buttons */
    button{padding:8px 14px; border-radius:8px; border:0; background:var(--accent); color:#fff; cursor:pointer; font-weight:500; transition:0.2s;}
    button:hover{background:var(--accent-hover);}
    button.ghost{background:transparent; color:var(--muted); border:1px solid #e5e7eb;}
    button.ghost:hover{background:#f3f4f6; color:#111;}
    button.danger{background:#fee2e2; color:#b91c1c; border:1px solid #fecaca;}
    button.danger:hover{background:#fecaca;}
    button.small{font-size:11px; padding:4px 8px;}
    
    /* Layouts */
    .row{display:flex; gap:10px; align-items:center;}
    .space-between{justify-content:space-between;}
    
    /* --- REDDIT THREAD STYLING --- */
    .reply-node {
        margin-top: 10px;
        position: relative;
    }
    
    .reply-content {
        background: #fff;
        padding: 8px 0; /* Minimal padding for clean look */
    }

    /* The vertical thread line */
    .thread-children {
        margin-left: 12px; /* Indent */
        padding-left: 12px;
        border-left: 2px solid var(--line-color); /* The Line */
    }

    .reply-header{display:flex; gap:8px; align-items:center; font-size:12px; color:#555; margin-bottom:4px;}
    .reply-body{font-size:14px; color:#222; margin-bottom:6px; line-height:1.4;}
    .reply-actions{display:flex; gap:10px; align-items:center; font-size:11px; font-weight:bold; color:#666;}
    .action-link{cursor:pointer; padding:2px 4px; border-radius:4px;}
    .action-link:hover{background:#f3f4f6; color:#111;}

    .continue-thread {
        margin-top: 8px;
        font-size: 13px;
        font-weight: 600;
        color: var(--accent);
        cursor: pointer;
        display: inline-block;
        padding: 4px 8px;
        border-radius: 12px;
        background: #eef2ff;
    }
    .continue-thread:hover { background: #e0e7ff; }

    /* Votes */
    .votes{display:flex; gap:2px; align-items:center;}
    .vote-arrow{cursor:pointer; padding:2px;}
    .vote-arrow:hover{color:var(--accent); background:#f0f9ff; border-radius:3px;}

    /* Modals */
    .modal{position:fixed; left:0; top:0; width:100%; height:100%; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.5); z-index:1000; backdrop-filter:blur(2px);}
    .modal .card{width:90%; max-width:750px; height:90vh; display:flex; flex-direction:column; padding:0; overflow:hidden;}
    
    .modal-header{padding:12px 16px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center; background:#fff;}
    .modal-scroll{flex:1; overflow-y:auto; padding:16px; background:#fff;}
    .modal-footer{padding:12px; border-top:1px solid #eee; background:#fff;}

    /* Replying Context Indicator */
    #replyingToIndicator{background:#e0e7ff; color:#4338ca; padding:4px 8px; border-radius:4px; font-size:12px; display:inline-block; margin-bottom:5px; display:none;}
    #replyingToIndicator span{cursor:pointer; font-weight:bold; margin-left:5px;}

    /* Auth Status */
    #authArea{text-align:right;}
    .badge{font-size:10px; text-transform:uppercase; padding:2px 4px; border-radius:4px; font-weight:bold;}
    .badge-op{background:#e0e7ff; color:var(--accent);}
    .badge-student{background:#f3f4f6; color:#374151;}

    /* Focus Mode Bar */
    #focusBar {
        background: #eff6ff;
        border-bottom: 1px solid #dbeafe;
        padding: 8px 16px;
        font-size: 13px;
        color: #1e40af;
        display: none; /* Hidden by default */
        align-items: center;
        gap: 8px;
    }
    #focusBar button { background: white; color: #1e40af; border: 1px solid #bfdbfe; font-size: 11px; padding: 2px 8px; border-radius: 4px; }

    @media (max-width:600px){ .row{flex-direction:column; align-items:stretch;} header{flex-direction:column; align-items:flex-start; gap:10px;} }
  </style>
</head>
<body>
  <script src="js/firebase.js"></script>

  <div class="wrap">
    <header>
      <div>
        <h1>Veddit</h1>
        <div class="small">Campus Doubt Forum</div>
      </div>
      <div id="authArea">
        <div id="authStatus" class="small" style="margin-bottom:5px;">Not signed in</div>
        <div id="authLinks">
          <a href="signup.html" class="link" style="color:var(--accent);text-decoration:underline;">Sign In / Join</a>
        </div>
        <button id="signOutBtn" class="small ghost hidden">Sign Out</button>
      </div>
    </header>

    <div id="postMin" class="card row space-between pointer" onclick="togglePostCreator(true)" style="cursor:pointer">
      <div>
        <strong>Have a doubt?</strong>
        <div class="small">Ask the community</div>
      </div>
      <button>Ask Doubt</button>
    </div>

    <div id="postCard" class="card hidden">
      <div class="row space-between">
        <strong>Create Post</strong>
        <button class="ghost small" onclick="togglePostCreator(false)">Cancel</button>
      </div>
      
      <div style="margin-top:12px;">
        <input id="qTitle" placeholder="Title (e.g., Error in Math 101)" maxlength="100">
        <textarea id="qBody" rows="4" placeholder="Describe your doubt in detail..."></textarea>
        
        <div class="row">
           <div style="flex:1">
             <input id="qTag" placeholder="Tag (e.g. Physics, Exam)">
           </div>
        </div>
        
        <div class="row space-between" style="margin-top:10px;">
           <label style="font-size:13px; display:flex; align-items:center; gap:6px; cursor:pointer;">
             <input type="checkbox" id="qAnon" style="width:auto; margin:0;"> Post Anonymously
           </label>
           <button id="postBtn">Post Doubt</button>
        </div>
        <div id="postStatus" class="small" style="color:var(--accent); margin-top:5px;"></div>
      </div>
    </div>

    <div id="feed" class="card" style="background:transparent; padding:0; box-shadow:none; border:0;">
      <h3 style="margin:0 0 10px 4px; font-size:16px;">Recent Discussions</h3>
      <div id="feedList"></div>
    </div>
  </div>

  <div id="replyModal" class="modal hidden">
    <div class="card">
      <div class="modal-header">
        <strong>Thread</strong>
        <button class="ghost small" onclick="closeThread()">Close</button>
      </div>

      <div id="focusBar">
          <span>You are viewing a single comment thread.</span>
          <button onclick="resetToFullThread()">View Full Discussion</button>
      </div>
      
      <div class="modal-scroll">
        <div id="threadContext" style="background:#f9fafb; padding:15px; border-radius:8px; margin-bottom:20px; border:1px solid #e5e7eb;"></div>
        
        <div id="focusedParentContext" style="background:#eef2ff; padding:15px; border-radius:8px; margin-bottom:20px; border:1px solid #c7d2fe; display:none;"></div>

        <div id="repliesContainer"></div>
      </div>
      
      <div class="modal-footer">
        <div id="replyingToIndicator">Replying to <b id="replyTargetName">...</b> <span onclick="cancelReplyTarget()">×</span></div>
        <textarea id="replyInput" rows="2" placeholder="Write a reply..."></textarea>
        <div class="row space-between">
          <label style="font-size:12px; display:flex; align-items:center; gap:4px;">
            <input type="checkbox" id="replyAnon" style="width:auto;"> Anon
          </label>
          <button id="sendReplyBtn" class="small">Send Reply</button>
        </div>
      </div>
    </div>
  </div>

<script src="js/veddit.js"></script>
</body>
</html>