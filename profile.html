<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Student Profile - Personal & Academic</title>
<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-storage-compat.js"></script>
<!-- Font Styles -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
font-family: 'Inter', sans-serif;
background-color: #F1F5F9;
color: #1E293B;
padding-top: 60px; /* Space for back button */
}

/* Back Button */
.back-btn-container {
position: absolute;
top: 20px;
left: 20px;
z-index: 100;
}

.back-btn {
display: inline-flex;
align-items: center;
gap: 8px;
text-decoration: none;
color: #1E293B;
font-weight: 600;
background: #FFFFFF;
padding: 10px 20px;
border-radius: 30px;
box-shadow: 0 2px 8px rgba(0,0,0,0.08);
transition: all 0.2s ease;
}

.back-btn:hover {
transform: translateX(-4px);
box-shadow: 0 4px 12px rgba(0,0,0,0.12);
color: #3B82F6;
}

/* Main Content */
.main-content { max-width:1280px; margin:0 auto; padding:2rem; opacity:0; transition: opacity .5s; }
.main-content.loaded { opacity:1; }

/* Top Section (Profile Card Wrapper) */
.top-section { 
display: block;
position: relative;
background: #FFFFFF;
border-radius: 12px;
box-shadow: 0 4px 12px rgba(0,0,0,0.06);
overflow: hidden;
margin-bottom: 2rem;
padding-bottom: 1.5rem;
}

/* Banner Section */
.profile-banner {
height: 200px;
width: 100%;
background-image: url('https://images.unsplash.com/photo-1557683316-973673baf926?q=80&w=2029&auto=format&fit=crop');
background-size: cover;
background-position: center;
position: relative;
}

.edit-banner-btn {
position: absolute;
top: 20px;
right: 20px;
background: #FFFFFF;
border: none;
border-radius: 50%;
width: 36px;
height: 36px;
cursor: pointer;
display: flex;
align-items: center;
justify-content: center;
box-shadow: 0 2px 4px rgba(0,0,0,0.2);
transition: transform 0.2s;
z-index: 10;
}
.edit-banner-btn:hover { transform: scale(1.1); }

/* Profile Info Area (Photo + Text) */
.profile-info-area {
padding: 0 2rem;
position: relative;
display: flex;
flex-direction: column;
align-items: flex-start;
}

.profile-photo-container { 
position:relative; 
width:160px; 
height:160px; 
margin-top: -80px; /* Overlap the banner */
margin-bottom: 1rem;
z-index: 5;
}

.profile-photo {
width:100%; 
height:100%; 
border-radius:50%; 
object-fit:cover; 
border: 6px solid #FFFFFF; /* White border to separate from banner */
background:#E0E7FF; 
display:flex; 
align-items:center; 
justify-content:center; 
font-size:3.5rem; 
color:#3B82F6;
box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.upload-photo-btn { 
position:absolute; 
bottom: 5px; 
right: 5px; 
background:#3B82F6; 
color:#fff; 
border: 2px solid #FFFFFF;
border-radius:50%;
width:36px; 
height:36px; 
cursor:pointer; 
font-size:1rem; 
box-shadow:0 2px 4px rgba(0,0,0,0.2); 
transition: background-color .3s; 
display: flex;
align-items: center;
justify-content: center;
}
.upload-photo-btn:hover { background:#2563EB; }

.student-identity {
margin-left: 0.5rem;
}

.student-name { 
font-family:'Poppins',sans-serif; 
font-size:1.75rem; 
font-weight:700; 
color:#1E293B; 
text-align:left; 
line-height: 1.2;
}

.student-roll { 
color:#64748B; 
font-size:1rem; 
margin-top:0.25rem; 
text-align:left;
}

/* Profile Details */
.profile-details { background:#fff; border-radius:12px; padding:2rem; box-shadow:0 4px 12px rgba(0,0,0,0.06); margin-bottom:2rem; }
.section-title { font-family:'Poppins',sans-serif; font-size:1.25rem; font-weight:600; color:#1E293B; margin-bottom:1.5rem; padding-bottom:.75rem; border-bottom:2px solid #F1F5F9; }
.info-grid { display:grid; grid-template-columns: repeat(3,1fr); gap:1.5rem; }
.info-item { display:flex; flex-direction:column; }
.info-label { font-size:.85rem; color:#64748B; margin-bottom:.5rem; font-weight:500; }
.info-value { font-size:1rem; color:#1E293B; font-weight:500; display:flex; align-items:center; gap:.5rem; }
.info-icon { font-size:1.2rem; }
.info-card-icon { font-size:3.2rem; }
.edit-profile-btn { margin-top:2rem; padding:.875rem 2rem; background:#3B82F6; color:#fff; border:none; border-radius:8px; font-weight:600; font-size:1rem; cursor:pointer; transition:background-color .3s; }
.edit-profile-btn:hover { background:#2563EB; }
.info-value input, .info-value select { width:100%; padding:.5rem; border:2px solid #E2E8F0; border-radius:6px; font-size:1rem; font-family:'Inter',sans-serif; color:#1E293B; transition:border-color .3s; }
.info-value input:focus, .info-value select:focus { outline:none; border-color:#3B82F6; }
.info-value input:disabled { background:#F8FAFC; cursor:not-allowed; }
.edit-mode-buttons { display:none; gap:1rem; margin-top:2rem; }
.edit-mode-buttons.active { display:flex; }
.save-btn { flex:1; padding:.875rem; background:#10B981; color:#fff; border:none; border-radius:8px; font-weight:600; font-size:1rem; cursor:pointer; }
.save-btn:hover{ background:#059669; }
.cancel-btn { flex:1; padding:.875rem; background:#EF4444; color:#fff; border:none; border-radius:8px; font-weight:600; font-size:1rem; cursor:pointer; }
.cancel-btn:hover{ background:#DC2626; }

.additional-info { background:#fff; border-radius:12px; padding:2rem; box-shadow:0 4px 12px rgba(0,0,0,0.06); }
.info-cards { display:grid; grid-template-columns: repeat(4,1fr); gap:1.5rem; margin-top:1.5rem; }
.info-card { background:linear-gradient(135deg,#3B82F6 0%,#2563EB 100%); padding:1.5rem; border-radius:10px; color:#fff; text-align:center; transition:transform .3s; }
.info-card:hover { transform: translateY(-4px); }

.footer { background:#1E293B; color:#fff; padding:2rem; text-align:center; margin-top:4rem; }
.footer-links { display:flex; justify-content:center; gap:2rem; margin-top:1rem; }
.footer-links a { color:#94A3B8; text-decoration:none; transition:color .3s; }
.footer-links a:hover { color:#fff; }

@media (max-width:1024px) { .info-grid{ grid-template-columns: repeat(2,1fr);} .info-cards{ grid-template-columns: repeat(2,1fr);} }
@media (max-width:768px) {
.profile-photo-container { margin: -60px auto 1rem auto; } /* Center photo on mobile */
.profile-info-area { align-items: center; } /* Center text on mobile */
.student-name, .student-roll { text-align: center; }
.student-identity { margin-left: 0; }
.info-grid{ grid-template-columns:1fr; }
.info-cards{ grid-template-columns:1fr; }
}
</style>
</head>
<body>
<!-- Hidden input for file upload -->
<input type="file" id="photoInput" accept="image/*" style="display:none" onchange="handlePhotoFileSelect(event)" />
<input type="file" id="bannerInput" accept="image/*" style="display:none" onchange="handleBannerFileSelect(event)" />

<!-- Back Button -->
<div class="back-btn-container">
    <a href="index.html" class="back-btn">
        <span>&larr;</span> Back to Home
    </a>
</div>

<!-- Main -->
<main class="main-content">
<!-- Unified Top Section -->
<div class="top-section">
    <!-- LinkedIn Style Banner -->
    <div class="profile-banner" id="profileBanner">
        <button class="edit-banner-btn" onclick="uploadBanner()" title="Change Cover Photo">‚úèÔ∏è</button>
    </div>

    <!-- Profile Info Overlapping Banner -->
    <div class="profile-info-area">
        <div class="profile-photo-container">
            <div class="profile-photo" id="profilePhoto">üë§</div>
            <button class="upload-photo-btn" onclick="uploadPhoto()">üì∑</button>
        </div>
        <div class="student-identity">
            <div class="student-name" id="displayFullName">Rahul Sharma</div>
            <div class="student-roll" id="displayRollNumber">Roll No: 2021CSE045</div>
        </div>
    </div>
</div>

<!-- Profile details -->
<div class="profile-details">
<h2 class="section-title">Personal Information</h2>
<div class="info-grid">
<div class="info-item">
<span class="info-label">Full Name</span>
<span class="info-value">
<span class="info-icon">üë§</span>
<input type="text" id="fullName" value="Rahul Sharma" disabled />
</span>
</div>
<div class="info-item">
<span class="info-label">Roll Number</span>
<span class="info-value">
<span class="info-icon">üé´</span>
<input type="text" id="rollNumber" value="2021CSE045" disabled />
</span>
</div>
<div class="info-item">
<span class="info-label">Branch</span>
<span class="info-value">
<span class="info-icon">üíª</span>
<select id="branch" disabled>
<option value="CSE" selected>Computer Science & Engineering</option>
<option value="ECE">Electronics & Communication</option>
<option value="ME">Mechanical Engineering</option>
<option value="CE">Civil Engineering</option>
<option value="EE">Electrical Engineering</option>
</select>
</span>
</div>

<div class="info-item">
<span class="info-label">Year</span>
<span class="info-value">
<span class="info-icon">üìÖ</span>
<select id="year" disabled>
<option value="1">1st Year (Semester 1-2)</option>
<option value="2">2nd Year (Semester 3-4)</option>
<option value="3" selected>3rd Year (Semester 5-6)</option>
<option value="4">4th Year (Semester 7-8)</option>
</select>
</span>
</div>

<div class="info-item">
<span class="info-label">Email Address</span>
<span class="info-value"><span class="info-icon">üìß</span><input type="email" id="email" value="rahul.sharma@college.edu" disabled /></span>
</div>
<div class="info-item">
<span class="info-label">Phone Number</span>
<span class="info-value"><span class="info-icon">üì±</span><input type="tel" id="phone" value="+91 98765 43210" disabled /></span>
</div>
<div class="info-item">
<span class="info-label">Date of Birth</span>
<span class="info-value"><span class="info-icon">üéÇ</span><input type="date" id="dob" value="2003-03-15" disabled /></span>
</div>
<div class="info-item">
<span class="info-label">Blood Group</span>
<span class="info-value"><span class="info-icon">ü©∏</span>
<select id="bloodGroup" disabled>
<option value="A+">A+</option>
<option value="A-">A-</option>
<option value="B+">B+</option>
<option value="B-">B-</option>
<option value="AB+">AB+</option>
<option value="AB-">AB-</option>
<option value="O+" selected>O+</option>
<option value="O-">O-</option>
</select>
</span>
</div>
<div class="info-item">
<span class="info-label">Address</span>
<span class="info-value"><span class="info-icon">üè†</span><input type="text" id="address" value="Mumbai, Maharashtra" disabled /></span>
</div>
</div>

<button class="edit-profile-btn" id="editBtn" onclick="toggleEditMode()">Edit Profile</button>
<div class="edit-mode-buttons" id="editModeButtons">
<button class="save-btn" onclick="saveProfile()">Save Changes</button>
<button class="cancel-btn" onclick="cancelEdit()">Cancel</button>
</div>
</div>



<!-- Footer -->
<footer class="footer"><p>&copy; 2025 | Your College Name</p><div class="footer-links"><a href="#contact">Contact / Support</a><a href="#calendar">Academic Calendar</a></div></footer>

<script>
// --- FIREBASE CONFIG (Unchanged) ---
const firebaseConfig = {
apiKey: "AIzaSyDCOT7bvPnU4zhOAkOG_nFxSLP0f58itgo",
authDomain: "veddit-a03a0.firebaseapp.com",
projectId: "veddit-a03a0",
storageBucket: "veddit-a03a0.firebasestorage.app",
messagingSenderId: "841975514674",
appId: "1:841975514674:web:3dcea2a6931cde3bfcde2b",
measurementId: "G-73VBEQ32GT"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();
const storage = firebase.storage();

let currentUser = null;
const PROFILE_COLLECTION = 'users';

function getProfileDocRef(uid) { return db.collection(PROFILE_COLLECTION).doc(uid); }

const displayFullName = document.getElementById('displayFullName');
const displayRollNumber = document.getElementById('displayRollNumber');
const profilePhotoElement = document.getElementById('profilePhoto');
const profileBannerElement = document.getElementById('profileBanner');
const mainContent = document.querySelector('.main-content');
const photoInput = document.getElementById('photoInput');
const bannerInput = document.getElementById('bannerInput');

function showContent() { mainContent.classList.add('loaded'); }

auth.onAuthStateChanged(user => {
if (user) {
currentUser = user;
console.log(`User signed in: ${user.uid}. Loading profile...`);
loadProfile(user.uid);
} else {
currentUser = null;
auth.signInAnonymously().then(anonUser => {
currentUser = anonUser.user;
console.log(`Signed in anonymously: ${currentUser.uid}. Loading profile...`);
loadProfile(currentUser.uid);
}).catch(error => {
console.error("Anonymous sign-in failed:", error);
showContent();
});
}
});

// ----------------- PROFILE + UPLOAD CODE -----------------
function loadProfile(uid) {
getProfileDocRef(uid).get().then(doc => {
if (doc.exists) {
const data = doc.data();
for (const key in data) {
const element = document.getElementById(key);
if (element) element.value = data[key];
}
displayFullName.textContent = data.fullName || 'Student Name';
displayRollNumber.textContent = `Roll No: ${data.rollNumber || 'N/A'}`;
if (data.photoURL) {
profilePhotoElement.innerHTML = `<img src="${data.photoURL}" alt="Profile" style="width:100%; height:100%; border-radius:50%; object-fit:cover;">`;
}
if (data.bannerURL) {
    profileBannerElement.style.backgroundImage = `url('${data.bannerURL}')`;
}
} else {
displayRollNumber.textContent = `Roll No: ${document.getElementById('rollNumber').value || 'N/A'}`;
}

// disable inputs
['fullName','rollNumber','email','phone','dob','bloodGroup','address','branch','year'].forEach(id => {
const el = document.getElementById(id);
if (el) el.disabled = true;
});
}).catch(e => {
console.error("Error loading profile:", e);
alert('Error loading profile data. Check Firebase permissions.');
}).finally(() => {
showContent();
});
}

function uploadPhoto() {
if (!currentUser) { alert('Please sign in to upload a photo.'); return; }
photoInput.click();
}

function uploadBanner() {
if (!currentUser) { alert('Please sign in to upload a banner.'); return; }
bannerInput.click();
}

async function handlePhotoFileSelect(event) {
const file = event.target.files[0];
if (!file) return;
try {
profilePhotoElement.innerHTML = `<div class="profile-photo" style="animation: spin 1s linear infinite;">‚è≥</div>`;
const photoURL = await uploadImageAndGetURL(file, 'profile_photos');
if (photoURL) {
profilePhotoElement.innerHTML = `<img src="${photoURL}" alt="Profile" style="width:100%; height:100%; border-radius:50%; object-fit:cover;">`;
await getProfileDocRef(currentUser.uid).set({ photoURL: photoURL }, { merge: true });
alert('‚úÖ Profile photo updated successfully!');
} else {
profilePhotoElement.innerHTML = `<div class="profile-photo">üë§</div>`;
alert('‚ùå Photo upload failed. Check browser console for storage errors.');
}
} catch (e) {
console.error("Upload process failed:", e);
profilePhotoElement.innerHTML = `<div class="profile-photo">üë§</div>`;
alert('‚ùå An error occurred during upload: ' + e.message);
} finally {
photoInput.value = '';
}
}

async function handleBannerFileSelect(event) {
const file = event.target.files[0];
if (!file) return;
try {
const bannerURL = await uploadImageAndGetURL(file, 'banners');
if (bannerURL) {
    profileBannerElement.style.backgroundImage = `url('${bannerURL}')`;
    await getProfileDocRef(currentUser.uid).set({ bannerURL: bannerURL }, { merge: true });
    alert('‚úÖ Banner updated successfully!');
} else {
    alert('‚ùå Banner upload failed.');
}
} catch (e) {
console.error("Upload process failed:", e);
alert('‚ùå An error occurred during upload: ' + e.message);
} finally {
bannerInput.value = '';
}
}

async function uploadImageAndGetURL(file, folder) {
try {
const storageRef = storage.ref();
const imageRef = storageRef.child(`${folder}/${currentUser.uid}/${Date.now()}_${file.name}`);
const snapshot = await imageRef.put(file);
return await snapshot.ref.getDownloadURL();
} catch (e) {
console.error("Error uploading image:", e);
if (e.code === 'storage/unauthorized') {
alert('‚ùå UPLOAD FAILED: Firebase Storage permission denied.');
}
return null;
}
}

// Edit/save/cancel
let isEditMode = false;
let originalValues = {};

function toggleEditMode() {
if (!currentUser) { alert('Please sign in or wait for automatic sign-in before editing.'); return; }
isEditMode = true;
originalValues = {
fullName: document.getElementById('fullName').value,
rollNumber: document.getElementById('rollNumber').value,
branch: document.getElementById('branch').value,
year: document.getElementById('year').value,
email: document.getElementById('email').value,
phone: document.getElementById('phone').value,
dob: document.getElementById('dob').value,
bloodGroup: document.getElementById('bloodGroup').value,
address: document.getElementById('address').value
};
['fullName','email','phone','dob','bloodGroup','address','branch','year'].forEach(id => {
const el = document.getElementById(id);
if (el) el.disabled = false;
});
document.getElementById('editBtn').style.display = 'none';
document.getElementById('editModeButtons').classList.add('active');
}

async function saveProfile() {
if (!currentUser) return;
const saveBtn = document.querySelector('.save-btn');
saveBtn.disabled = true; saveBtn.textContent = 'Saving...';
const updatedData = {
fullName: document.getElementById('fullName').value,
rollNumber: document.getElementById('rollNumber').value,
branch: document.getElementById('branch').value,
year: document.getElementById('year').value,
email: document.getElementById('email').value,
phone: document.getElementById('phone').value,
dob: document.getElementById('dob').value,
bloodGroup: document.getElementById('bloodGroup').value,
address: document.getElementById('address').value,
lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
};
try {
await getProfileDocRef(currentUser.uid).set(updatedData, { merge: true });
displayFullName.textContent = updatedData.fullName;
displayRollNumber.textContent = `Roll No: ${updatedData.rollNumber}`;
['fullName','rollNumber','email','phone','dob','bloodGroup','address','branch','year'].forEach(id => {
const el = document.getElementById(id);
if (el) el.disabled = true;
});
document.getElementById('editBtn').style.display = 'block';
document.getElementById('editModeButtons').classList.remove('active');
isEditMode = false;
alert('‚úÖ Profile updated successfully!');
} catch (e) {
console.error("Error saving profile:", e);
alert('Error saving profile changes: ' + e.message);
} finally {
saveBtn.disabled = false; saveBtn.textContent = 'Save Changes';
}
}

function cancelEdit() {
// Revert to original values
if (originalValues.fullName !== undefined) {
document.getElementById('fullName').value = originalValues.fullName;
document.getElementById('rollNumber').value = originalValues.rollNumber;
document.getElementById('branch').value = originalValues.branch;
document.getElementById('year').value = originalValues.year;
document.getElementById('email').value = originalValues.email;
document.getElementById('phone').value = originalValues.phone;
document.getElementById('dob').value = originalValues.dob;
document.getElementById('bloodGroup').value = originalValues.bloodGroup;
document.getElementById('address').value = originalValues.address;
}
['fullName','rollNumber','email','phone','dob','bloodGroup','address','branch','year'].forEach(id => {
const el = document.getElementById(id);
if (el) el.disabled = true;
});
document.getElementById('editBtn').style.display = 'block';
document.getElementById('editModeButtons').classList.remove('active');
isEditMode = false;
}
</script>
</body>
</html>