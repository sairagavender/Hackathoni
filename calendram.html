<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic Scheduler â€” Veddit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #6366f1; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background-color: #f3f4f6; }
        .calendar-day-box {
            height: 40px;
            width: 14.28%; /* 100% / 7 days */
            transition: background-color 0.15s;
        }
        .event-dot {
            height: 6px;
            width: 6px;
            background-color: #f64e60;
            border-radius: 50%;
            margin-top: 2px;
        }
        .timetable-header-cell { min-width: 120px; }
        .timetable-cell { min-width: 120px; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="app" class="flex flex-col h-screen">
        <header class="bg-white shadow-md p-4 flex items-center justify-between z-10">
            <h1 class="text-2xl font-bold text-indigo-600">Calendram</h1>
            <div class="flex items-center space-x-4">
                <span id="user-role-display" class="text-xs font-bold uppercase px-2 py-1 rounded bg-gray-200 text-gray-700">Loading...</span>
                <nav>
                    <button onclick="switchView('dashboard')" id="nav-dashboard" class="nav-button bg-indigo-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-indigo-600 transition duration-150 shadow-md">Dashboard</button>
                    <button onclick="switchView('timetable-editor')" id="nav-editor" class="nav-button hidden text-gray-700 px-4 py-2 rounded-lg font-medium hover:bg-gray-100 transition duration-150">Editor</button>
                    <button onclick="switchView('event-adder')" id="nav-events" class="nav-button hidden text-gray-700 px-4 py-2 rounded-lg font-medium hover:bg-gray-100 transition duration-150">Add Event</button>
                    <a href="index.html" class="text-gray-500 hover:text-indigo-600 ml-2 text-sm font-medium">Exit</a>
                </nav>
            </div>
        </header>

        <main class="flex-grow p-6 overflow-y-auto custom-scrollbar">
            <div id="loading-overlay" class="fixed inset-0 bg-white bg-opacity-90 flex items-center justify-center z-50">
                <div class="flex flex-col items-center">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"></div>
                    <p class="mt-4 text-indigo-600 font-medium">Checking permissions...</p>
                </div>
            </div>
            <div id="error-message" class="hidden bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4 rounded-lg" role="alert">
                <p class="font-bold">Error</p>
                <p id="error-text">Something went wrong.</p>
            </div>
            
            <div id="dashboard-view" class="view-content space-y-8">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg border border-indigo-100">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-semibold text-gray-800">Class Timetable</h2>
                            <p id="current-timetable-name" class="text-sm font-medium text-indigo-500 bg-indigo-50 px-3 py-1 rounded-full"></p>
                        </div>
                        <div id="current-timetable" class="overflow-x-auto">
                            <p class="text-gray-500 italic" id="no-timetable-msg">No active timetable found.</p>
                        </div>
                    </div>
                    
                    <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg border border-yellow-100">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-semibold text-gray-800">Calendar</h2>
                            <span id="current-month-display" class="text-lg font-bold text-yellow-600"></span>
                        </div>
                        <div id="calendar-view"></div>
                    </div>
                </div>

                <div class="grid grid-cols-1 gap-6">
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-pink-100">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Upcoming Events</h2>
                        <div id="upcoming-events" class="space-y-3 max-h-96 overflow-y-auto custom-scrollbar">
                            <p class="text-gray-500 italic">No events scheduled yet.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="timetable-editor-view" class="view-content hidden">
                <div class="max-w-6xl mx-auto space-y-6">
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-green-100">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Subject Manager</h2>
                        <div class="flex flex-wrap gap-2 mb-4" id="subject-list">
                            <span class="text-gray-500 italic text-sm">Add a subject below.</span>
                        </div>
                        <form id="subject-form" class="flex gap-4" onsubmit="addSubject(event)">
                            <input type="text" id="new-subject-name" required placeholder="New Subject Name" class="flex-grow p-2 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500">
                            <button type="submit" class="bg-green-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-green-700 transition duration-150">Add</button>
                        </form>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-lg border border-indigo-100">
                        <h2 class="text-2xl font-semibold text-gray-800 mb-6">Edit Timetable</h2>
                        <form id="timetable-form" onsubmit="handleTimetableSubmit(event)" class="space-y-4">
                            <div class="flex flex-col sm:flex-row gap-4 mb-6">
                                <div class="flex-grow">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Timetable Name</label>
                                    <input type="text" id="timetable-name" required placeholder="e.g., Semester 1" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Load Existing</label>
                                    <select id="load-timetable" onchange="loadTimetableForEditing(this.value)" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 bg-white">
                                        <option value="">-- New --</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-6 border p-4 rounded-lg bg-gray-50">
                                <h3 class="font-medium text-gray-700 mb-2">Time Slots</h3>
                                <div id="time-slot-editor" class="flex flex-wrap gap-2 mb-4"></div>
                                <div class="flex flex-wrap items-center gap-3">
                                    <div class="flex items-center space-x-1">
                                        <label class="text-xs">Start:</label>
                                        <select id="start-hour" class="p-1 border rounded-md text-sm bg-white"></select>:<select id="start-minute" class="p-1 border rounded-md text-sm bg-white"></select><select id="start-ampm" class="p-1 border rounded-md text-sm bg-white"><option value="AM">AM</option><option value="PM">PM</option></select>
                                    </div>
                                    <span class="font-bold text-gray-700">-</span>
                                    <div class="flex items-center space-x-1">
                                        <label class="text-xs">End:</label>
                                        <select id="end-hour" class="p-1 border rounded-md text-sm bg-white"></select>:<select id="end-minute" class="p-1 border rounded-md text-sm bg-white"></select><select id="end-ampm" class="p-1 border rounded-md text-sm bg-white"><option value="AM">AM</option><option value="PM">PM</option></select>
                                    </div>
                                    <button type="button" onclick="addTimeSlot()" class="bg-indigo-500 text-white text-sm px-3 py-1 rounded-lg">Add</button>
                                </div>
                                <p id="time-slot-error" class="text-sm text-red-500 mt-2 hidden">Invalid time.</p>
                            </div>

                            <div id="editor-grid-container" class="overflow-x-auto border rounded-lg"></div>
                            <button type="submit" class="w-full bg-indigo-600 text-white font-semibold py-3 rounded-xl hover:bg-indigo-700 shadow-md">Save Timetable</button>
                        </form>
                    </div>
                </div>
            </div>

            <div id="event-adder-view" class="view-content hidden">
                <div class="max-w-xl mx-auto bg-white p-6 rounded-xl shadow-lg border border-pink-100">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-6">Add Event</h2>
                    <form id="event-form" onsubmit="handleEventSubmit(event)" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Category</label>
                            <select id="event-type" onchange="toggleEventFormFields(this.value)" required class="w-full mt-1 p-3 border border-gray-300 rounded-lg">
                                <option value="" disabled selected>-- Select --</option>
                                <option value="CulturalEvent">Cultural Event</option>
                                <option value="ActivityEvent">Activity Event</option>
                                <option value="Exam">Exam</option>
                                <option value="Assignment">Assignment</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Name</label>
                            <input type="text" id="event-name" required class="w-full mt-1 p-3 border border-gray-300 rounded-lg" placeholder="Event Title">
                        </div>
                        <div class="flex gap-4">
                            <div class="flex-1">
                                <label class="block text-sm font-medium text-gray-700">Date</label>
                                <input type="date" id="event-date" required class="w-full mt-1 p-3 border border-gray-300 rounded-lg">
                            </div>
                            <div class="flex-1">
                                <label class="block text-sm font-medium text-gray-700">Time</label>
                                <input type="time" id="event-time" class="w-full mt-1 p-3 border border-gray-300 rounded-lg">
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <input type="checkbox" id="show-countdown" class="h-4 w-4 text-pink-600" checked>
                            <label for="show-countdown" class="text-sm font-medium text-gray-700">Show Countdown</label>
                        </div>
                        <div>
                            <label id="event-media-label" class="block text-sm font-medium text-gray-700">Media URL</label>
                            <input type="url" id="event-poster-url" class="w-full mt-1 p-3 border border-gray-300 rounded-lg" placeholder="https://...">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Description</label>
                            <textarea id="event-description" rows="3" class="w-full mt-1 p-3 border border-gray-300 rounded-lg"></textarea>
                        </div>
                        <button type="submit" class="w-full bg-pink-600 text-white font-semibold py-3 rounded-xl hover:bg-pink-700 shadow-md">Save Event</button>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <script type="module" src="js/calendram.js">
        </script>
</body>
</html>